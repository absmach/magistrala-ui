<!-- Copyright (c) Abstract Machines
SPDX-License-Identifier: Apache-2.0 -->

{{ define "navbar" }}
  <!-- Sidebbar -->
  <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark" id="accordionSidebar">
    <!-- Sidebar Brand -->
    <a class="sidebar-brand d-flex justify-content-center pt-2" href="/">
      <h1 class="mx-3">Magistrala</h1>
    </a>

    <!-- Divider -->
    <hr class="sidebar-divider my-0 text-light mb-3" />

    <div id="index-nav-items">
      <li class="nav-item mb-2 mx-2">
        {{ $navbarActive := "homepage" }}
        <a
          href="/"
          id="index"
          class="nav-link sidebar-link {{ if eq .NavbarActive $navbarActive }}active{{ end }}"
        >
          <i class="fas fa-home"></i>
          <span>Home Page</span>
        </a>
      </li>

      <li class="nav-item mb-2 mx-2">
        {{ $navbarActive := "dashboard" }}
        <a
          href="/dashboards"
          id="dashboard"
          class="nav-link sidebar-link {{ if eq .NavbarActive $navbarActive }}active{{ end }}"
        >
          <i class="fas fa-chart-line"></i>
          <span>Dashboard</span>
        </a>
      </li>

      <!-- Divider -->
      <hr class="sidebar-divider my-0 text-light mb-3" />
    </div>

    <!-- Heading -->
    <div class="sidebar-heading mb-3">DOMAINS MANAGEMENT</div>

    <li class="nav-item mb-2 mx-2">
      {{ $collapseActive := "domains" }}
      <a
        href="#domains-collapse"
        data-bs-toggle="collapse"
        aria-expanded="false"
        aria-controls="domains-collapse"
        class="dropdown-toggle nav-link sidebar-link {{ if eq .CollapseActive $collapseActive }}
          active
        {{ end }}"
      >
        <i class="fa-solid fa-sitemap"></i>
        <span>Domains</span>
      </a>
      <div
        class="collapse {{ if eq .CollapseActive $collapseActive }}
          show
        {{ end }}"
        id="domains-collapse"
      >
        <ul class="collapse-list">
          <li class="nav-item mb-2 mx-2">
            {{ $navbarActive = "domains" }}
            <a
              href="/domains"
              class="nav-link {{ if eq .NavbarActive $navbarActive }}
                active
              {{ end }}
              "
              id="domains"
            >
              <i class="fa-solid fa-sitemap"></i>
              <span>Domains</span>
            </a>
          </li>
          <li class="nav-item mb-2 mx-2">
            {{ $navbarActive = "invitations" }}
            <a
              href="/invitations"
              class="nav-link {{ if eq .NavbarActive $navbarActive }}
                active
              {{ end }}"
              id="invitations"
            >
              <i class="fa-solid fa-envelope"></i>
              <span>Invitations</span>
            </a>
          </li>
        </ul>
      </div>
    </li>

    <li class="nav-item mb-2 mx-2" id="domain-nav-item">
      {{ $collapseActive = "domain" }}
      <a
        href="#domain-collapse"
        data-bs-toggle="collapse"
        aria-expanded="false"
        aria-controls="domain-collapse"
        class="dropdown-toggle nav-link sidebar-link {{ if eq .CollapseActive $collapseActive }}
          active
        {{ end }}"
      >
        <i class="fa-solid fa-building"></i>
        <span id="sidebar-domain-name"></span>
      </a>
      <div
        class="collapse {{ if eq .CollapseActive $collapseActive }}
          show
        {{ end }}"
        id="domain-collapse"
      >
        <ul class="collapse-list">
          <li class="nav-item mb-2 mx-2">
            {{ $navbarActive = "domain" }}
            <a
              href=""
              class="nav-link {{ if eq .NavbarActive $navbarActive }}active{{ end }}"
              id="domain"
            >
              <i class="fa-solid fa-building"></i>
              <span>Domain</span>
            </a>
          </li>
          <li class="nav-item mb-2 mx-2">
            {{ $navbarActive = "members" }}
            <a
              href=""
              id="members"
              class="nav-link  {{ if eq .NavbarActive $navbarActive }}active{{ end }}"
            >
              <i class="fa-solid fa-users"></i>
              <span>Members</span>
            </a>
          </li>
          <li class="nav-item mb-2 mx-2">
            {{ $navbarActive = "domaininvitations" }}
            <a
              href=""
              class="nav-link {{ if eq .NavbarActive $navbarActive }}active{{ end }}"
              id="domainInvitations"
            >
              <i class="fa-solid fa-envelope"></i>
              <span>Invitations</span>
            </a>
          </li>
        </ul>
      </div>
    </li>

    <li class="nav-item mb-2 mx-2">
      {{ $navbarActive = "users" }}
      <a
        href="/users"
        class=" nav-link sidebar-link {{ if (serviceUnavailable "users") }}
          disabled-item
        {{ end }} {{ if eq .NavbarActive $navbarActive }}active{{ end }}"
      >
        <i class="fas fa-users"></i>
        <span>Users</span>
      </a>
    </li>

    <div id="things-nav-items">
      <!-- Divider -->
      <hr class="sidebar-divider my-0 text-light mb-3" />

      <!-- Heading -->
      <div class="sidebar-heading mb-3">THINGS MANAGEMENT</div>
      <li class="nav-item mb-2 mx-2">
        {{ $navbarActive = "groups" }}
        <a
          href="/groups"
          id="groups"
          class="nav-link sidebar-link {{ if (serviceUnavailable "users") }}
            disabled-item
          {{ end }} {{ if eq .NavbarActive $navbarActive }}active{{ end }}"
        >
          <i class="fas fa-layer-group"></i>
          <span>Groups</span>
        </a>
      </li>
      <li class="nav-item mb-2 mx-2">
        {{ $navbarActive = "things" }}
        <a
          href="/things"
          id="things"
          class="nav-link sidebar-link {{ if (serviceUnavailable "things") }}
            disabled-item
          {{ end }} {{ if eq .NavbarActive $navbarActive }}active{{ end }}"
        >
          <i class="fas fa-microchip"></i>
          <span>Things</span>
        </a>
      </li>
      <li class="nav-item mb-2 mx-2">
        {{ $navbarActive = "channels" }}
        <a
          href="/channels"
          id="channels"
          class="nav-link sidebar-link {{ if (serviceUnavailable "things") }}
            disabled-item
          {{ end }} {{ if eq .NavbarActive $navbarActive }}active{{ end }}"
        >
          <i class="fas fa-exchange-alt"></i>
          <span>Channels</span>
        </a>
      </li>
      <li class="nav-item mb-2 mx-2">
        {{ $navbarActive = "bootstraps" }}
        <a
          href="/bootstraps"
          id="bootstraps"
          class="nav-link sidebar-link {{ if (serviceUnavailable "bootstrap") }}
            disabled-item
          {{ end }} {{ if eq .NavbarActive $navbarActive }}active{{ end }}"
        >
          <i class="fas fa-solid fa-broadcast-tower"></i>
          <span>Bootstrap</span>
        </a>
      </li>
    </div>

    <!-- Sidebar Toggler (Sidebar) -->
    <div class="d-flex justify-content-center">
      <button class="rounded-circle border-0" id="sidebarToggle"></button>
    </div>
  </ul>

  <!-- End of sidebar -->

  <!-- Header navbar -->
  <nav class="navbar navbar-expand topbar fixed-top">
    <div class="container-fluid mb-3">
      <div class="sidebar-toggle">
        <!-- Sidebar Toggle (Topbar) -->
        <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3 user-item">
          <i class="fa fa-bars"></i>
        </button>
      </div>

      <div class="navbarSupportedContent">
        <ul class="navbar-nav ms-auto d-flex align-items-center">
          <li class="nav-item me-2">
            <a
              href="https://docs.mainflux.io/"
              target="_blank"
              class="doc-button btn"
              role="button"
            >
              <span>Documentation</span>
            </a>
          </li>
          <li class="nav-item dropdown me-3" id="domain-header-dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              data-bs-display="static"
              aria-expanded="false"
              id="domainName"
            ></a>
            <ul class="dropdown-menu dropdown-menu-md-end mt-2 p-3">
              <li class="text-center fw-bold">
                <span class="drop-item" id="domainName2"></span>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a
                  class="dropdown-item user-item-button p-2 mb-2"
                  href="#"
                  role="button"
                  onclick="openCreateDomainModal()"
                >
                  <i class="fa-solid fa-square-plus"></i>
                  Create Domain
                </a>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a class="dropdown-item user-item-button p-2 mb-2" href="/domains">
                  <i class="fa-solid fa-repeat"></i>
                  Switch Domain
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item dropstart me-3">
            <a
              class="user-item nav-link"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <i class="fa-solid fa-user"></i>
            </a>
            <ul class="dropdown-menu mt-5 position-absolute end-0 p-3">
              <li class="d-flex justify-content-start mb-2">
                <div class="align-self-center">
                  <i class="fa-regular fa-user fs-2"></i>
                </div>
                <div>
                  <span class="dropdown-item" id="username"></span>
                  <span class="dropdown-item text-muted" id="identity"></span>
                </div>
              </li>
              <li class="mb-2"><hr class="dropdown-divider" /></li>
              <li class="mb-2">
                <a href="/password" class="dropdown-item user-item-button p-2 mb-2">
                  <i class="fas fa-solid fa-lock me-2"></i>
                  <span>Update password</span>
                </a>
                <a class="dropdown-item user-item-button p-2 mb-2" onclick="logout();">
                  <i class="fa-solid fa-right-from-bracket me-2"></i>
                  <span>Log out</span>
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  {{ template "metadatamodal" }}

  <!-- Modal -->
  <div
    class="modal fade"
    id="createDomainModal"
    tabindex="-1"
    aria-labelledby="createDomainModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title" id="createDomainModalLabel">Create Domain</h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <form action="/domains" method="post">
          <div class="modal-body">
            <div class="row mb-3">
              <div class="col-md-12">
                <label for="domain-name" class="form-label">Name *</label>
                <input type="text" class="form-control p-2" name="name" id="domain-name" required />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-12">
                <label for="domain-alias" class="form-label">Alias</label>
                <input type="text" class="form-control p-2" name="alias" id="domain-alias" />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-12">
                <label for="domain-tags" class="form-label">Tags</label>
                <div id="tagsList" onclick="deleteItem(event)"></div>
                <input
                  type="text"
                  class="form-control"
                  name="tags"
                  id="domain-tags"
                  aria-describedby="tagHelp"
                  onkeydown="addItem(event, 'domain-tags', 'tagsList')"
                  placeholder="Add a tag"
                />
                <div id="tagHelp" class="form-text">Enter Domain tags as a string slice.</div>
                <div id="domainTagsError" class="error-message text-danger"></div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-12">
                <label for="domain-metadata" class="form-label">Metadata</label>
                <div class="metadata-field">
                  <textarea name="metadata" id="domain-metadata"></textarea>
                </div>
                <div id="metadataHelp" class="form-text">Enter Domain metadata in JSON format.</div>
                <div id="domainMetadataError" class="error-message text-danger"></div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button
              type="submit"
              id="create-domain-button"
              class="btn body-button"
              onclick="submitItemList('domain-tags', 'tagsList')"
            >
              Create
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="/js/listUtils.js"></script>
  <script defer>
    var loginStatus = localStorage.getItem("loginStatus");
    var name = localStorage.getItem("userName");
    var identity = localStorage.getItem("userIdentity");
    var domainID = localStorage.getItem("domainID");
    var domainName = localStorage.getItem("domainName");
    var domainPermission = localStorage.getItem("domainPermission");

    if (loginStatus === "general") {
      document.getElementById("domain-nav-item").style.display = "none";
      document.getElementById("things-nav-items").style.display = "none";
      document.getElementById("index-nav-items").style.display = "none";
      document.getElementById("domain-header-dropdown").style.display = "none";
    }
    document.getElementById("domain").href = "/domains/" + domainID;
    document.getElementById("members").href = "/domains/" + domainID + "/members";
    document.getElementById("domainInvitations").href = "/invitations?domain=" + domainID;
    document.getElementById("domainName").innerHTML = domainName;
    document.getElementById("domainName2").innerHTML = domainName;
    document.getElementById("username").innerHTML = name;
    document.getElementById("identity").innerHTML = identity;
    document.getElementById("sidebar-domain-name").innerHTML = domainName;

    if (domainPermission !== "administrator") {
      document.getElementById("domainInvitations").style.display = "none";
    }

    const createDomainModal = new bootstrap.Modal(document.getElementById("createDomainModal"));
    function openCreateDomainModal() {
      createDomainModal.show();
    }
    // Toggle the side navigation
    document.querySelectorAll("#sidebarToggle, #sidebarToggleTop").forEach(function (element) {
      element.addEventListener("click", function (e) {
        document.body.classList.toggle("sidebar-toggled");
        document.querySelector(".sidebar").classList.toggle("toggled");
      });
    });

    // Close any open menu accordions when window is resized below 768px
    window.addEventListener("resize", function () {
      // Toggle the side navigation when window is resized below 480px
      if (
        window.innerWidth < 480 &&
        !document.querySelector(".sidebar").classList.contains("toggled")
      ) {
        document.body.classList.add("sidebar-toggled");
        document.querySelector(".sidebar").classList.add("toggled");
      }
    });

    function logout() {
      fetch("/logout", {
        method: "GET",
      }).then((response) => {
        if (response.status === 200) {
          localStorage.clear();
          window.location.href = "/login";
        }
      });
    }

    codeMirrorEditor({
      textArea: "domain-metadata",
      button: "create-domain-button",
      value: {},
    });
  </script>
{{ end }}
