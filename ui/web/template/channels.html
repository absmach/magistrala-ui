<!-- Copyright (c) Abstract Machines
SPDX-License-Identifier: Apache-2.0 -->

{{ define "channels" }}
	<!doctype html>
	<html lang="en">
		{{ template "header" }}
		<body>
			{{ template "navbar" . }}
			<div class="main-content pt-3">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 mx-auto py-3">
							<div class="row">
								<div class="buttons mb-3">
									<!-- Button trigger modal -->
									<button
										type="button"
										class="btn body-button"
										onclick="openModal('single')"
									>
										Add Channel
									</button>

									<!-- Modal -->
									<div
										class="modal fade"
										id="addChannelModal"
										tabindex="-1"
										role="dialog"
										aria-labelledby="addChannelModalLabel"
										aria-hidden="true"
									>
										<div class="modal-dialog" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title" id="addChannelModalLabel">
														Add Channel
													</h5>
												</div>
												<div class="modal-body">
													<div id="alertMessage"></div>
													<form method="post" id="channelform">
														<div class="mb-3">
															<label for="name" class="form-label">Name</label>
															<input
																type="text"
																class="form-control"
																name="name"
																id="name"
																placeholder="Channel Name"
															/>
															<div id="nameError" class="text-danger"></div>
														</div>
														<div class="mb-3">
															<label for="infiniteScroll" class="form-label">
																Parent Name
															</label>
															<input
																type="text"
																class="itemsFilter"
																name="parentFilter"
																id="parentFilter"
																placeholder="Filter by parent name"
															/>
															<select
																class="form-select"
																name="parentID"
																id="infiniteScroll"
																size="5"
															>
																<option disabled>select a channel</option>
															</select>
														</div>
														<div class="mb-3">
															<label for="description" class="form-label">
																Description
															</label>
															<input
																type="text"
																class="form-control"
																name="description"
																id="description"
																placeholder="Channel Description"
															/>
														</div>
														<div class="mb-3">
															<label for="metadata" class="form-label">
																Metadata
															</label>
															<input
																type="text"
																class="form-control"
																name="metadata"
																id="metadata"
																value="{}"
															/>
															<div id="metadataHelp" class="form-text">
																Enter channel metadata in JSON format.
															</div>
															<div id="metadataError" class="text-danger"></div>
														</div>
														<button
															type="submit"
															class="btn body-button"
															id="create-channel-button"
														>
															Submit
														</button>
													</form>
												</div>
											</div>
										</div>
									</div>

									<!-- Button trigger modal -->
									<button
										type="button"
										class="btn body-button"
										onclick="openModal('bulk')"
									>
										Add Channels
									</button>

									<!-- Modal -->
									<div
										class="modal fade"
										id="addChannelsModal"
										tabindex="-1"
										role="dialog"
										aria-labelledby="addChannelsModalLabel"
										aria-hidden="true"
									>
										<div class="modal-dialog" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title" id="addChannelsModalLabel">
														Add Channels
													</h5>
												</div>
												<div class="modal-body">
													<div id="alertBulkMessage"></div>
													<form
														method="post"
														enctype="multipart/form-data"
														id="bulkchannelsform"
													>
														<div class="form-group">
															<label for="channelsFile">
																Add csv file containing channels names with
																metadata. The metadata field can be empty. Find
																a sample csv file
																<a
																	href="https://github.com/absmach/magistrala-ui/blob/main/samples/channels.csv"
																	target="_blank"
																>
																	here
																</a>
															</label>
															<input
																type="file"
																class="form-control-file"
																id="channelsFile"
																name="channelsFile"
																required
															/>
															<button
																type="submit"
																value="upload"
																class="btn body-button"
															>
																Submit
															</button>
														</div>
													</form>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="table-responsive table-container">
									{{ template "tableheader" . }}
									<div class="itemsTable">
										<table id="itemsTable" class="table">
											<thead>
												<tr>
													<th scope="col">Name</th>
													<th scope="col">ID</th>
													<th class="desc-col" scope="col">Description</th>
													<th class="meta-col" scope="col">Metadata</th>
													<th class="created-col" scope="col">Created At</th>
													<th class="text-center" scope="col"></th>
												</tr>
											</thead>
											<tbody>
												{{ range $i, $c := .Channels }}
													{{ $disableButton := false }}
													<tr>
														<td>{{ $c.Name }}</td>
														<td>
															<div class="copy-con-container">
																<a href="{{ printf "/channels/%s" $c.ID }}">
																	{{ $c.ID }}
																</a>
																<button
																	class="copy-icon"
																	onclick="copyToClipboard(this)"
																>
																	<i class="far fa-copy"></i>
																</button>
															</div>
														</td>
														<td class="desc-col">{{ $c.Description }}</td>
														<td class="meta-col">{{ toJSON $c.Metadata }}</td>
														<td class="created-col">{{ $c.CreatedAt }}</td>
														<td class="text-center">
															<form action="/channels/disabled" method="post">
																<input
																	type="hidden"
																	name="channelID"
																	id="channelID"
																	value="{{ $c.ID }}"
																/>
																<button
																	type="submit"
																	class="btn btn-sm"
																	{{ if
																		$disableButton
																	}}
																		disabled
																	{{ end }}
																>
																	<i class="fas fa-trash-alt"></i>
																</button>
															</form>
														</td>
													</tr>
												{{ end }}
											</tbody>
										</table>
									</div>
									{{ template "tablefooter" . }}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			{{ template "footer" }}
			<script>
				attachValidationListener({
					buttonId: "create-channel-button",
					errorDivs: {
						name: "nameError",
						metadata: "metadataError",
					},
					validations: {
						name: validateName,
						metadata: validateMetadata,
					},
				});

				const channelModal = new bootstrap.Modal(
					document.getElementById("addChannelModal"),
				);
				const channelsModal = new bootstrap.Modal(
					document.getElementById("addChannelsModal"),
				);

				function openModal(modal) {
					if (modal === "single") {
						channelModal.show();
					} else if (modal === "bulk") {
						channelsModal.show();
					}
				}

				submitCreateForm({
					url: "/channels",
					formId: "channelform",
					alertDiv: "alertMessage",
					modal: channelModal,
				});

				submitCreateForm({
					url: "/channels/bulk",
					formId: "bulkchannelsform",
					alertDiv: "alertBulkMessage",
					modal: channelsModal,
				});

				fetchIndividualEntity({
					input: "parentFilter",
					itemSelect: "infiniteScroll",
					item: "channels",
				});
			</script>
		</body>
	</html>
{{ end }}
