<!-- Copyright (c) Abstract Machines
SPDX-License-Identifier: Apache-2.0 -->

{{ define "organizations" }}
	<!doctype html>
	<html lang="en">
		{{ template "header" }}
		<body class="organizations-body">
			<div class="container">
				<div class="row pt-5 mt-5">
					<div class="organizations-card col-lg-6 p-md-5 mx-auto mt-5 bg-white">
						<div class="row text-center">
							<div class="mb-3 border-bottom pb-3">
								<div class="d-flex justify-content-center mt-2">
									<h1 class="mx-3">Magistrala</h1>
								</div>
							</div>
						</div>
						<div class="organizations-table pb-3 mb-3">
							<div class=" text-center mb-4">
								<h2>Organizations</h2>
							</div>
							<div class="table-responsive">
								{{ template "tableheader" . }}
								<div class="itemsTable">
									<table class="table border-top">
										<tbody>
											{{ range $i,$d := .Domains }}
												<tr>
													<td>{{ $d.Name }}</td>
													<td class="d-flex justify-content-evenly">
														<form
															action="/organizations/login"
															method="post"
															onsubmit="addToLocalStorage('{{ $d.ID }}', '{{ $d.Name }}')"
														>
															<input
																type="hidden"
																name="orgID"
																id="orgID"
																value="{{ $d.ID }}"
															/>
															<button type="submit" class="btn body-button">
																Log In
															</button>
														</form>
														<button
															type="button"
															class="btn btn-outline-danger"
															data-bs-toggle="modal"
															data-bs-target="#deleteOrganizationModal{{ $i }}"
														>
															<i class="fas fa-trash-alt"></i>
														</button>

														<!-- Modal -->
														<div
															class="modal fade"
															id="deleteOrganizationModal{{ $i }}"
															tabindex="-1"
															aria-labelledby="deleteOrganizationModalLabel{{ $i }}"
															aria-hidden="true"
														>
															<div class="modal-dialog">
																<div class="modal-content">
																	<div class="modal-header">
																		<h1
																			class="modal-title fs-5 fw-bold"
																			id="deleteOrganizationModalLabel{{ $i }}"
																		>
																			Delete Organization
																		</h1>
																		<button
																			type="button"
																			class="btn-close"
																			data-bs-dismiss="modal"
																			aria-label="Close"
																		></button>
																	</div>
																	<form action="">
																		<div class="modal-body">
																			<p>
																				Are you sure you want to delete this
																				organization?
																			</p>
																			<h6 class="fw-semibold">
																				Enter Organization Name to Confirm
																			</h6>
																			<input
																				type="text"
																				class="form-control"
																				name="organizationName"
																				id="organizationName"
																				required
																			/>
																			<!-- TODO perform validation to check if the name the user inputs is same as the name of the 
                                          organization they want to delete -->
																			<input
																				type="hidden"
																				class="form-control"
																				name="organizationID"
																				id="organizationID"
																				value="{{ $d.ID }}"
																			/>
																		</div>
																		<div class="modal-footer">
																			<button
																				type="button"
																				class="btn btn-outline-secondary"
																				data-bs-dismiss="modal"
																			>
																				Close
																			</button>
																			<button
																				type="submit"
																				class="btn btn-outline-danger"
																			>
																				Delete Organization
																			</button>
																		</div>
																	</form>
																</div>
															</div>
														</div>
													</td>
												</tr>
											{{ end }}
										</tbody>
									</table>
								</div>
								{{ template "tablefooter" . }}
							</div>
							<div class="d-flex justify-content-end">
								<button
									type="button"
									class="btn body-button"
									data-bs-toggle="modal"
									data-bs-target="#createOrganizationModal"
								>
									<i class="fa-solid fa-plus me-2"></i>
									Create Organization
								</button>
							</div>

							<!-- Modal -->
							<div
								class="modal fade"
								id="createOrganizationModal"
								tabindex="-1"
								aria-labelledby="createOrganizationModalLabel"
								aria-hidden="true"
							>
								<div class="modal-dialog modal-dialog-centered">
									<div class="modal-content">
										<div class="modal-header">
											<h1
												class="modal-title fs-5 fw-bold"
												id="createOrganizationModalLabel"
												style="font-weight: 600"
											>
												Create Organization
											</h1>
											<button
												type="button"
												class="btn-close"
												data-bs-dismiss="modal"
												aria-label="Close"
											></button>
										</div>
										<form action="/organizations" method="post">
											<div class="modal-body">
												<div class="row mb-3">
													<div class="col-md-12">
														<label for="name" class="form-label">Name *</label>
														<input
															type="text"
															class="form-control p-2"
															name="name"
															id="name"
															required
														/>
													</div>
												</div>
												<div class="row mb-3">
													<div class="col-md-12">
														<label for="alias" class="form-label">Alias</label>
														<input
															type="text"
															class="form-control p-2"
															name="alias"
															id="alias"
														/>
													</div>
												</div>
												<div class="row mb-3">
													<div class="col-md-12">
														<label for="tags" class="form-label">Tags</label>
														<input
															type="text"
															class="form-control"
															name="tags"
															id="tags"
															aria-describedby="tagHelp"
															value="[]"
														/>
														<div id="tagHelp" class="form-text">
															Enter organization tags as a string slice.
														</div>
														<div
															id="tagsError"
															class="error-message text-danger"
														></div>
													</div>
													
												</div>
                                                <div class="row mb-3">
                                                    <div class="col-md-12">
														<label for="metadata" class="form-label">
															Metadata
														</label>
														<input
															type="text"
															class="form-control"
															name="metadata"
															id="metadata"
															value="{}"
														/>
														<div id="metadataHelp" class="form-text">
															Enter organization metadata in JSON format.
														</div>
														<div
															id="metadataError"
															class="error-message text-danger"
														></div>
													</div>
                                                </div>
											</div>
											<div class="modal-footer">
												<button
													type="button"
													class="btn btn-secondary"
													data-bs-dismiss="modal"
												>
													Cancel
												</button>
												<button type="submit" class="btn btn-outline-dark">
													Create
												</button>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<script>
				function addToLocalStorage(id, name) {
					localStorage.setItem("organizationID", id);
					localStorage.setItem("organizationName", name);
				}
			</script>
		</body>
	</html>
{{ end }}
